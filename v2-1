// ==================== é¢å¤–é¡µé¢æ–‡ä»¶ ====================

// ========== /pages/teacher/detail.js ==========
Page({
  data: {
    teacherId: null,
    teacherInfo: null,
    courses: [],
    reviews: [],
    activeTab: 0
  },

  onLoad(options) {
    this.setData({ teacherId: options.id });
    this.loadTeacherInfo();
    this.loadCourses();
    this.loadReviews();
  },

  loadTeacherInfo() {
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });
    
    // æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”è¯¥è°ƒç”¨API
    this.setData({
      teacherInfo: {
        id: this.data.teacherId,
        name: 'æè€å¸ˆ',
        avatar: '/images/default-avatar.png',
        experience_years: 5,
        total_students: 128,
        rating: 4.9,
        introduction: 'æ¯•ä¸šäºä¸­å¤®éŸ³ä¹å­¦é™¢ï¼Œå…·æœ‰ä¸°å¯Œçš„æ•™å­¦ç»éªŒï¼Œæ“…é•¿é’¢ç´å’Œå£°ä¹æ•™å­¦ã€‚æ³¨é‡åŸ¹å…»å­¦ç”Ÿçš„éŸ³ä¹ç´ å…»å’Œæ¼”å¥æŠ€å·§ã€‚',
        achievements: [
          'ä¸­å¤®éŸ³ä¹å­¦é™¢ç¡•å£«å­¦ä½',
          'å…¨å›½é’¢ç´æ¯”èµ›é‡‘å¥–æŒ‡å¯¼æ•™å¸ˆ',
          '5å¹´ä»¥ä¸Šæ•™å­¦ç»éªŒ'
        ]
      }
    });
    
    wx.hideLoading();
  },

  loadCourses() {
    // åŠ è½½æ•™å¸ˆæ•™æˆçš„è¯¾ç¨‹
    this.setData({
      courses: [
        { id: 1, name: 'é’¢ç´', price: 200, duration: 60 },
        { id: 2, name: 'å£°ä¹', price: 180, duration: 60 }
      ]
    });
  },

  loadReviews() {
    // åŠ è½½è¯„ä»·
    this.setData({
      reviews: [
        {
          id: 1,
          student_name: 'å¼ åŒå­¦',
          rating: 5,
          content: 'è€å¸ˆéå¸¸ä¸“ä¸šï¼Œæ•™å­¦è®¤çœŸè´Ÿè´£ï¼',
          date: '2024-01-10'
        },
        {
          id: 2,
          student_name: 'æåŒå­¦',
          rating: 5,
          content: 'è¯¾ç¨‹å†…å®¹ä¸°å¯Œï¼Œæ”¶è·å¾ˆå¤§',
          date: '2024-01-08'
        }
      ]
    });
  },

  switchTab(e) {
    this.setData({ activeTab: e.currentTarget.dataset.index });
  },

  bookCourse() {
    if (!getApp().globalData.token) {
      wx.navigateTo({ url: '/pages/login/login' });
      return;
    }
    
    wx.navigateTo({
      url: `/pages/appointment/create?teacherId=${this.data.teacherId}&teacherName=${this.data.teacherInfo.name}`
    });
  }
});

// ========== /pages/teacher/detail.wxml ==========
`<view class="container">
  <!-- æ•™å¸ˆä¿¡æ¯å¤´éƒ¨ -->
  <view class="teacher-header">
    <image class="teacher-avatar" src="{{teacherInfo.avatar}}"></image>
    <view class="teacher-info">
      <view class="teacher-name">{{teacherInfo.name}}</view>
      <view class="teacher-meta">
        <text class="meta-item">{{teacherInfo.experience_years}}å¹´æ•™é¾„</text>
        <text class="meta-item">{{teacherInfo.total_students}}ä½å­¦ç”Ÿ</text>
      </view>
      <view class="teacher-rating">
        <text class="stars">â­â­â­â­â­</text>
        <text class="score">{{teacherInfo.rating}}åˆ†</text>
      </view>
    </view>
  </view>
  
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 0 ? 'active' : ''}}" 
          bindtap="switchTab" data-index="0">ç®€ä»‹</view>
    <view class="tab-item {{activeTab === 1 ? 'active' : ''}}" 
          bindtap="switchTab" data-index="1">è¯¾ç¨‹</view>
    <view class="tab-item {{activeTab === 2 ? 'active' : ''}}" 
          bindtap="switchTab" data-index="2">è¯„ä»·</view>
  </view>
  
  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content">
    <!-- ç®€ä»‹æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 0}}" class="intro-content">
      <view class="section">
        <view class="section-title">ä¸ªäººç®€ä»‹</view>
        <view class="section-content">{{teacherInfo.introduction}}</view>
      </view>
      
      <view class="section">
        <view class="section-title">æ•™å­¦æˆå°±</view>
        <view class="achievement-list">
          <view class="achievement-item" wx:for="{{teacherInfo.achievements}}" wx:key="*this">
            <text class="achievement-icon">âœ“</text>
            <text class="achievement-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 1}}" class="course-content">
      <view class="course-card" wx:for="{{courses}}" wx:key="id">
        <view class="course-name">{{item.name}}</view>
        <view class="course-meta">
          <text class="course-duration">{{item.duration}}åˆ†é’Ÿ/èŠ‚</text>
          <text class="course-price">Â¥{{item.price}}</text>
        </view>
      </view>
    </view>
    
    <!-- è¯„ä»·æ ‡ç­¾é¡µ -->
    <view wx:if="{{activeTab === 2}}" class="review-content">
      <view class="review-card" wx:for="{{reviews}}" wx:key="id">
        <view class="review-header">
          <text class="student-name">{{item.student_name}}</text>
          <text class="review-date">{{item.date}}</text>
        </view>
        <view class="review-rating">
          <text class="stars">â­â­â­â­â­</text>
        </view>
        <view class="review-text">{{item.content}}</view>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨é¢„çº¦æŒ‰é’® -->
  <view class="bottom-bar">
    <button class="book-btn" bindtap="bookCourse">ç«‹å³é¢„çº¦</button>
  </view>
</view>`

// ========== /pages/teacher/detail.wxss ==========
`.teacher-header {
  display: flex;
  padding: 30rpx;
  background: white;
}

.teacher-avatar {
  width: 150rpx;
  height: 150rpx;
  border-radius: 75rpx;
  margin-right: 30rpx;
}

.teacher-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.teacher-name {
  font-size: 36rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 15rpx;
}

.teacher-meta {
  display: flex;
  gap: 20rpx;
  margin-bottom: 15rpx;
}

.meta-item {
  font-size: 26rpx;
  color: #666;
}

.teacher-rating {
  display: flex;
  align-items: center;
}

.stars {
  font-size: 24rpx;
  margin-right: 10rpx;
}

.score {
  font-size: 28rpx;
  color: #ff9500;
  font-weight: bold;
}

.tabs {
  display: flex;
  background: white;
  margin-top: 20rpx;
}

.tab-item {
  flex: 1;
  text-align: center;
  padding: 30rpx 0;
  font-size: 30rpx;
  color: #666;
  position: relative;
}

.tab-item.active {
  color: #4A90E2;
  font-weight: bold;
}

.tab-item.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 60rpx;
  height: 4rpx;
  background: #4A90E2;
}

.content {
  padding: 20rpx;
  padding-bottom: 120rpx;
}

.section {
  background: white;
  border-radius: 20rpx;
  padding: 30rpx;
  margin-bottom: 20rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 20rpx;
}

.section-content {
  font-size: 28rpx;
  color: #666;
  line-height: 1.6;
}

.achievement-list {
  margin-top: 20rpx;
}

.achievement-item {
  display: flex;
  align-items: center;
  margin-bottom: 15rpx;
}

.achievement-icon {
  color: #4A90E2;
  margin-right: 15rpx;
  font-size: 28rpx;
}

.achievement-text {
  font-size: 28rpx;
  color: #666;
}

.course-card {
  background: white;
  border-radius: 15rpx;
  padding: 25rpx;
  margin-bottom: 15rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.course-name {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
}

.course-meta {
  text-align: right;
}

.course-duration {
  font-size: 24rpx;
  color: #999;
  display: block;
  margin-bottom: 10rpx;
}

.course-price {
  font-size: 36rpx;
  color: #ff4444;
  font-weight: bold;
}

.review-card {
  background: white;
  border-radius: 15rpx;
  padding: 25rpx;
  margin-bottom: 15rpx;
}

.review-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15rpx;
}

.student-name {
  font-size: 30rpx;
  font-weight: bold;
  color: #333;
}

.review-date {
  font-size: 24rpx;
  color: #999;
}

.review-rating {
  margin-bottom: 15rpx;
}

.review-text {
  font-size: 28rpx;
  color: #666;
  line-height: 1.5;
}

.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20rpx 30rpx;
  background: white;
  box-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.05);
}

.book-btn {
  width: 100%;
  height: 90rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 45rpx;
  font-size: 32rpx;
  border: none;
}`

// ========== /pages/teacher/detail.json ==========
// {
//   "navigationBarTitleText": "æ•™å¸ˆè¯¦æƒ…"
// }

// ========== /pages/teacher/schedule.js ==========
Page({
  data: {
    weekDays: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
    timeSlots: [],
    schedules: {},
    currentWeek: [],
    selectedDate: ''
  },

  onLoad() {
    this.initTimeSlots();
    this.initWeekDates();
    this.loadMySchedule();
  },

  initTimeSlots() {
    const slots = [];
    for (let hour = 9; hour < 21; hour++) {
      slots.push({
        start: `${hour}:00`,
        end: `${hour + 1}:00`,
        label: `${hour}:00-${hour + 1}:00`
      });
    }
    this.setData({ timeSlots: slots });
  },

  initWeekDates() {
    const today = new Date();
    const currentWeek = [];
    
    for (let i = 0; i < 7; i++) {
      const date = new Date(today);
      date.setDate(today.getDate() - today.getDay() + i + 1);
      currentWeek.push({
        date: this.formatDate(date),
        day: this.data.weekDays[i],
        dayNum: date.getDate()
      });
    }
    
    this.setData({ 
      currentWeek,
      selectedDate: this.formatDate(today)
    });
  },

  formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  },

  loadMySchedule() {
    // è·å–æ•™å¸ˆçš„æ—¶é—´è¡¨
    const userInfo = getApp().globalData.userInfo;
    if (!userInfo) return;
    
    // æ¨¡æ‹Ÿæ•°æ®
    const schedules = {};
    this.data.currentWeek.forEach(day => {
      schedules[day.date] = [];
    });
    
    this.setData({ schedules });
  },

  selectDate(e) {
    const date = e.currentTarget.dataset.date;
    this.setData({ selectedDate: date });
  },

  toggleTimeSlot(e) {
    const { time } = e.currentTarget.dataset;
    const { selectedDate, schedules } = this.data;
    
    if (!schedules[selectedDate]) {
      schedules[selectedDate] = [];
    }
    
    const index = schedules[selectedDate].indexOf(time);
    if (index > -1) {
      schedules[selectedDate].splice(index, 1);
    } else {
      schedules[selectedDate].push(time);
    }
    
    this.setData({ schedules });
  },

  isTimeSelected(time) {
    const { selectedDate, schedules } = this.data;
    return schedules[selectedDate] && schedules[selectedDate].includes(time);
  },

  saveSchedule() {
    wx.showLoading({ title: 'ä¿å­˜ä¸­...' });
    
    // æ•´ç†æ•°æ®æ ¼å¼
    const scheduleData = [];
    Object.keys(this.data.schedules).forEach(date => {
      this.data.schedules[date].forEach(time => {
        scheduleData.push({
          date: date,
          time: time
        });
      });
    });
    
    // è°ƒç”¨APIä¿å­˜
    getApp().request({
      url: '/teacher-schedules',
      method: 'POST',
      data: { schedules: scheduleData }
    }).then(() => {
      wx.hideLoading();
      wx.showToast({ title: 'ä¿å­˜æˆåŠŸ', icon: 'success' });
    }).catch(() => {
      wx.hideLoading();
    });
  }
});

// ========== /pages/teacher/schedule.wxml ==========
`<view class="container">
  <!-- æ˜ŸæœŸé€‰æ‹© -->
  <view class="week-selector">
    <view class="week-item {{selectedDate === item.date ? 'active' : ''}}" 
          wx:for="{{currentWeek}}" 
          wx:key="date"
          bindtap="selectDate"
          data-date="{{item.date}}">
      <text class="week-day">{{item.day}}</text>
      <text class="week-date">{{item.dayNum}}</text>
    </view>
  </view>
  
  <!-- æ—¶é—´æ®µé€‰æ‹© -->
  <view class="time-section">
    <view class="section-title">é€‰æ‹©å¯ç”¨æ—¶é—´æ®µ</view>
    <view class="time-grid">
      <view class="time-slot {{isTimeSelected(item.start) ? 'selected' : ''}}"
            wx:for="{{timeSlots}}" 
            wx:key="start"
            bindtap="toggleTimeSlot"
            data-time="{{item.start}}">
        {{item.label}}
      </view>
    </view>
  </view>
  
  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="save-section">
    <button class="save-btn" bindtap="saveSchedule">ä¿å­˜æ—¶é—´è¡¨</button>
  </view>
</view>`

// ========== /pages/teacher/schedule.wxss ==========
`.week-selector {
  display: flex;
  background: white;
  padding: 20rpx;
  margin-bottom: 20rpx;
}

.week-item {
  flex: 1;
  text-align: center;
  padding: 20rpx 10rpx;
  border-radius: 15rpx;
  transition: all 0.3s;
}

.week-item.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.week-day {
  display: block;
  font-size: 24rpx;
  margin-bottom: 10rpx;
}

.week-date {
  display: block;
  font-size: 32rpx;
  font-weight: bold;
}

.time-section {
  background: white;
  padding: 30rpx;
  margin: 20rpx;
  border-radius: 20rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 30rpx;
}

.time-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20rpx;
}

.time-slot {
  padding: 20rpx;
  text-align: center;
  background: #f5f5f5;
  border-radius: 10rpx;
  font-size: 26rpx;
  color: #333;
  transition: all 0.3s;
}

.time-slot.selected {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.save-section {
  padding: 20rpx 40rpx 40rpx;
}

.save-btn {
  width: 100%;
  height: 90rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 45rpx;
  font-size: 32rpx;
  border: none;
}`

// ========== /pages/teacher/schedule.json ==========
// {
//   "navigationBarTitleText": "æ—¶é—´ç®¡ç†"
// }

// ========== /pages/admin/dashboard.js ==========
Page({
  data: {
    stats: {
      totalStudents: 0,
      totalTeachers: 0,
      todayAppointments: 0,
      monthRevenue: 0
    },
    recentAppointments: [],
    chartData: null
  },

  onLoad() {
    this.checkAdminRole();
    this.loadDashboardData();
  },

  checkAdminRole() {
    const role = getApp().globalData.role;
    if (role !== 'admin') {
      wx.showToast({
        title: 'æ— æƒé™è®¿é—®',
        icon: 'none'
      });
      setTimeout(() => {
        wx.switchTab({ url: '/pages/index/index' });
      }, 1500);
    }
  },

  loadDashboardData() {
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });
    
    // æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”è¯¥è°ƒç”¨å¤šä¸ªAPI
    this.setData({
      stats: {
        totalStudents: 256,
        totalTeachers: 18,
        todayAppointments: 24,
        monthRevenue: 45280
      },
      recentAppointments: [
        {
          id: 1,
          student_name: 'å¼ ä¸‰',
          teacher_name: 'æè€å¸ˆ',
          course_name: 'é’¢ç´',
          appointment_date: '2024-01-15',
          start_time: '14:00',
          status: 'confirmed'
        },
        {
          id: 2,
          student_name: 'æå››',
          teacher_name: 'ç‹è€å¸ˆ',
          course_name: 'å‰ä»–',
          appointment_date: '2024-01-15',
          start_time: '15:00',
          status: 'pending'
        }
      ]
    });
    
    wx.hideLoading();
  },

  goToSalary() {
    wx.navigateTo({ url: '/pages/admin/salary' });
  },

  goToCourseManage() {
    wx.navigateTo({ url: '/pages/admin/course' });
  },

  goToTeacherManage() {
    wx.navigateTo({ url: '/pages/admin/teacher' });
  },

  goToStudentManage() {
    wx.navigateTo({ url: '/pages/admin/student' });
  },

  viewAppointmentDetail(e) {
    const id = e.currentTarget.dataset.id;
    wx.navigateTo({ url: `/pages/admin/appointment-detail?id=${id}` });
  },

  exportData() {
    wx.showModal({
      title: 'å¯¼å‡ºæ•°æ®',
      content: 'ç¡®å®šè¦å¯¼å‡ºæœ¬æœˆæ•°æ®æŠ¥è¡¨å—ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          wx.showToast({ title: 'å¯¼å‡ºæˆåŠŸ', icon: 'success' });
        }
      }
    });
  }
});

// ========== /pages/admin/dashboard.wxml ==========
`<view class="container">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-grid">
    <view class="stat-card">
      <view class="stat-icon">ğŸ‘¥</view>
      <view class="stat-info">
        <view class="stat-value">{{stats.totalStudents}}</view>
        <view class="stat-label">æ€»å­¦ç”Ÿæ•°</view>
      </view>
    </view>
    
    <view class="stat-card">
      <view class="stat-icon">ğŸ‘¨â€ğŸ«</view>
      <view class="stat-info">
        <view class="stat-value">{{stats.totalTeachers}}</view>
        <view class="stat-label">æ€»æ•™å¸ˆæ•°</view>
      </view>
    </view>
    
    <view class="stat-card">
      <view class="stat-icon">ğŸ“…</view>
      <view class="stat-info">
        <view class="stat-value">{{stats.todayAppointments}}</view>
        <view class="stat-label">ä»Šæ—¥é¢„çº¦</view>
      </view>
    </view>
    
    <view class="stat-card">
      <view class="stat-icon">ğŸ’°</view>
      <view class="stat-info">
        <view class="stat-value">Â¥{{stats.monthRevenue}}</view>
        <view class="stat-label">æœ¬æœˆæ”¶å…¥</view>
      </view>
    </view>
  </view>
  
  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="goToSalary">
      <view class="action-icon">ğŸ’³</view>
      <view class="action-name">å·¥èµ„ç»“ç®—</view>
    </view>
    <view class="action-item" bindtap="goToCourseManage">
      <view class="action-icon">ğŸ“š</view>
      <view class="action-name">è¯¾ç¨‹ç®¡ç†</view>
    </view>
    <view class="action-item" bindtap="goToTeacherManage">
      <view class="action-icon">ğŸ‘¨â€ğŸ«</view>
      <view class="action-name">æ•™å¸ˆç®¡ç†</view>
    </view>
    <view class="action-item" bindtap="goToStudentManage">
      <view class="action-icon">ğŸ‘¥</view>
      <view class="action-name">å­¦ç”Ÿç®¡ç†</view>
    </view>
  </view>
  
  <!-- æœ€è¿‘é¢„çº¦ -->
  <view class="recent-section">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘é¢„çº¦</text>
      <text class="section-more" bindtap="goToAllAppointments">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>
    
    <view class="appointment-list">
      <view class="appointment-item" 
            wx:for="{{recentAppointments}}" 
            wx:key="id"
            bindtap="viewAppointmentDetail"
            data-id="{{item.id}}">
        <view class="appointment-info">
          <view class="appointment-main">
            <text class="student-name">{{item.student_name}}</text>
            <text class="course-name">{{item.course_name}}</text>
          </view>
          <view class="appointment-meta">
            <text class="teacher-name">{{item.teacher_name}}</text>
            <text class="appointment-time">{{item.appointment_date}} {{item.start_time}}</text>
          </view>
        </view>
        <view class="appointment-status status-{{item.status}}">
          {{item.status === 'pending' ? 'å¾…ç¡®è®¤' : 'å·²ç¡®è®¤'}}
        </view>
      </view>
    </view>
  </view>
  
  <!-- å¯¼å‡ºæŒ‰é’® -->
  <view class="export-section">
    <button class="export-btn" bindtap="exportData">å¯¼å‡ºæ•°æ®æŠ¥è¡¨</button>
  </view>
</view>`

// ========== /pages/admin/dashboard.wxss ==========
`.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20rpx;
  padding: 20rpx;
}

.stat-card {
  background: white;
  border-radius: 20rpx;
  padding: 30rpx;
  display: flex;
  align-items: center;
  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
}

.stat-icon {
  font-size: 60rpx;
  margin-right: 20rpx;
}

.stat-info {
  flex: 1;
}

.stat-value {
  font-size: 36rpx;
  font-weight: bold;
  color: #333;
}

.stat-label {
  font-size: 24rpx;
  color: #999;
  margin-top: 5rpx;
}

.quick-actions {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20rpx;
  padding: 20rpx;
  background: white;
  margin: 20rpx;
  border-radius: 20rpx;
}

.action-item {
  text-align: center;
  padding: 20rpx;
}

.action-icon {
  font-size: 50rpx;
  margin-bottom: 10rpx;
}

.action-name {
  font-size: 24rpx;
  color: #666;
}

.recent-section {
  margin: 20rpx;
  background: white;
  border-radius: 20rpx;
  padding: 30rpx;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
}

.section-more {
  font-size: 26rpx;
  color: #4A90E2;
}

.appointment-list {
  margin-top: 20rpx;
}

.appointment-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20rpx 0;
  border-bottom: 1rpx solid #f0f0f0;
}

.appointment-item:last-child {
  border-bottom: none;
}

.appointment-info {
  flex: 1;
}

.appointment-main {
  display: flex;
  gap: 20rpx;
  margin-bottom: 10rpx;
}

.student-name {
  font-size: 30rpx;
  font-weight: bold;
  color: #333;
}

.course-name {
  font-size: 26rpx;
  color: #666;
  padding: 2rpx 10rpx;
  background: #f0f0f0;
  border-radius: 10rpx;
}

.appointment-meta {
  display: flex;
  gap: 20rpx;
  font-size: 24rpx;
  color: #999;
}

.appointment-status {
  padding: 8rpx 20rpx;
  border-radius: 20rpx;
  font-size: 24rpx;
}

.status-pending {
  background: #fff7e6;
  color: #ff9500;
}

.status-confirmed {
  background: #e6f7ff;
  color: #1890ff;
}

.export-section {
  padding: 20rpx 40rpx 40rpx;
}

.export-btn {
  width: 100%;
  height: 90rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 45rpx;
  font-size: 32rpx;
  border: none;
}`

// ========== /pages/admin/dashboard.json ==========
// {
//   "navigationBarTitleText": "ç®¡ç†åå°"
// }

// ========== /pages/admin/salary.js ==========
Page({
  data: {
    currentYear: new Date().getFullYear(),
    currentMonth: new Date().getMonth() + 1,
    salaryData: [],
    totalAmount: 0,
    selectedTeacher: null
  },

  onLoad() {
    this.loadSalaryData();
  },

  loadSalaryData() {
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });
    
    getApp().request({
      url: `/salary/monthly?year=${this.data.currentYear}&month=${this.data.currentMonth}`,
      method: 'GET'
    }).then(data => {
      wx.hideLoading();
      
      const total = data.reduce((sum, item) => sum + (item.total_amount || 0), 0);
      
      this.setData({
        salaryData: data,
        totalAmount: total
      });
    }).catch(() => {
      wx.hideLoading();
    });
  },

  bindDateChange(e) {
    const [year, month] = e.detail.value.split('-');
    this.setData({
      currentYear: parseInt(year),
      currentMonth: parseInt(month)
    });
    this.loadSalaryData();
  },

  generateSalary() {
    wx.showModal({
      title: 'ç¡®è®¤ç”Ÿæˆ',
      content: `ç¡®å®šè¦ç”Ÿæˆ${this.data.currentYear}å¹´${this.data.currentMonth}æœˆçš„å·¥èµ„å•å—ï¼Ÿ`,
      success: (res) => {
        if (res.confirm) {
          wx.showLoading({ title: 'ç”Ÿæˆä¸­...' });
          
          getApp().request({
            url: '/salary/generate',
            method: 'POST',
            data: {
              year: this.data.currentYear,
              month: this.data.currentMonth
            }
          }).then(() => {
            wx.hideLoading();
            wx.showToast({ title: 'ç”ŸæˆæˆåŠŸ', icon: 'success' });
            this.loadSalaryData();
          }).catch(() => {
            wx.hideLoading();
          });
        }
      }
    });
  },

  viewTeacherDetail(e) {
    const teacher = e.currentTarget.dataset.teacher;
    this.setData({ selectedTeacher: teacher });
    
    wx.navigateTo({
      url: `/pages/admin/teacher-salary?id=${teacher.teacher_id}&year=${this.data.currentYear}&month=${this.data.currentMonth}`
    });
  },

  markAsPaid(e) {
    const teacherId = e.currentTarget.dataset.id;
    
    wx.showModal({
      title: 'ç¡®è®¤å‘æ”¾',
      content: 'ç¡®å®šå·²å‘è¯¥æ•™å¸ˆå‘æ”¾å·¥èµ„å—ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          wx.showToast({ title: 'å·²æ ‡è®°ä¸ºå·²å‘æ”¾', icon: 'success' });
          // æ›´æ–°çŠ¶æ€
          this.loadSalaryData();
        }
      }
    });
  },

  exportSalary() {
    wx.showToast({ title: 'æ­£åœ¨å¯¼å‡º...', icon: 'loading' });
    // å®é™…å¯¼å‡ºé€»è¾‘
    setTimeout(() => {
      wx.showToast({ title: 'å¯¼å‡ºæˆåŠŸ', icon: 'success' });
    }, 1500);
  }
});

// ========== /pages/admin/salary.wxml ==========
`<view class="container">
  <!-- æœˆä»½é€‰æ‹© -->
  <view class="month-selector">
    <picker mode="date" fields="month" value="{{currentYear}}-{{currentMonth}}" bindchange="bindDateChange">
      <view class="month-display">
        <text class="month-text">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
    <view class="total-amount">
      <text class="total-label">å·¥èµ„æ€»é¢</text>
      <text class="total-value">Â¥{{totalAmount}}</text>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-bar">
    <button class="action-btn primary" bindtap="generateSalary">ç”Ÿæˆå·¥èµ„å•</button>
    <button class="action-btn" bindtap="exportSalary">å¯¼å‡ºExcel</button>
  </view>
  
  <!-- å·¥èµ„åˆ—è¡¨ -->
  <view class="salary-list">
    <view class="salary-item" 
          wx:for="{{salaryData}}" 
          wx:key="teacher_id">
      <view class="teacher-info" bindtap="viewTeacherDetail" data-teacher="{{item}}">
        <view class="teacher-name">{{item.teacher_name}}</view>
        <view class="teacher-stats">
          <text class="stat-item">{{item.total_classes || 0}}èŠ‚è¯¾</text>
          <text class="stat-item">{{item.total_hours || 0}}å°æ—¶</text>
        </view>
      </view>
      <view class="salary-info">
        <view class="salary-amount">Â¥{{item.total_amount || 0}}</view>
        <button class="pay-btn" bindtap="markAsPaid" data-id="{{item.teacher_id}}">
          æ ‡è®°å·²å‘æ”¾
        </button>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{salaryData.length === 0}}" class="empty">
    <text class="empty-icon">ğŸ’°</text>
    <text class="empty-text">æš‚æ— å·¥èµ„æ•°æ®</text>
    <button class="generate-btn" bindtap="generateSalary">ç”Ÿæˆå·¥èµ„å•</button>
  </view>
</view>`

// ========== /pages/admin/salary.wxss ==========
`.month-selector {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 30rpx;
  margin: 20rpx;
  border-radius: 20rpx;
}

.month-display {
  display: flex;
  align-items: center;
  padding: 15rpx 30rpx;
  background: #f5f5f5;
  border-radius: 10rpx;
}

.month-text {
  font-size: 32rpx;
  color: #333;
  margin-right: 10rpx;
}

.arrow {
  font-size: 20rpx;
  color: #999;
}

.total-amount {
  text-align: right;
}

.total-label {
  font-size: 24rpx;
  color: #999;
  display: block;
  margin-bottom: 10rpx;
}

.total-value {
  font-size: 48rpx;
  font-weight: bold;
  color: #4A90E2;
}

.action-bar {
  display: flex;
  gap: 20rpx;
  padding: 0 20rpx;
  margin-bottom: 20rpx;
}

.action-btn {
  flex: 1;
  height: 80rpx;
  border-radius: 40rpx;
  font-size: 28rpx;
  background: #f5f5f5;
  color: #666;
  border: none;
}

.action-btn.primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.salary-list {
  padding: 0 20rpx;
}

.salary-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 30rpx;
  border-radius: 20rpx;
  margin-bottom: 20rpx;
}

.teacher-info {
  flex: 1;
}

.teacher-name {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 10rpx;
}

.teacher-stats {
  display: flex;
  gap: 20rpx;
}

.stat-item {
  font-size: 24rpx;
  color: #666;
  padding: 4rpx 12rpx;
  background: #f5f5f5;
  border-radius: 10rpx;
}

.salary-info {
  text-align: right;
}

.salary-amount {
  font-size: 36rpx;
  font-weight: bold;
  color: #ff4444;
  margin-bottom: 15rpx;
}

.pay-btn {
  padding: 10rpx 25rpx;
  background: #52c41a;
  color: white;
  border-radius: 20rpx;
  font-size: 24rpx;
  border: none;
}

.empty {
  text-align: center;
  padding: 100rpx 40rpx;
}

.empty-icon {
  font-size: 100rpx;
  display: block;
  margin-bottom: 30rpx;
}

.empty-text {
  font-size: 30rpx;
  color: #999;
  margin-bottom: 40rpx;
}

.generate-btn {
  width: 300rpx;
  height: 80rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 40rpx;
  font-size: 28rpx;
  border: none;
}`

// ========== /pages/admin/salary.json ==========
// {
//   "navigationBarTitleText": "å·¥èµ„ç»“ç®—"
// }

// ========== /pages/course/list.js ==========
Page({
  data: {
    courseTypes: []
  },

  onLoad() {
    this.loadCourseTypes();
  },

  loadCourseTypes() {
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });
    
    getApp().request({
      url: '/course-types',
      method: 'GET'
    }).then(data => {
      wx.hideLoading();
      this.setData({ 
        courseTypes: data.map(item => ({
          ...item,
          icon: this.getCourseIcon(item.name),
          studentCount: Math.floor(Math.random() * 100) + 50,
          teacherCount: Math.floor(Math.random() * 10) + 5
        }))
      });
    }).catch(() => {
      wx.hideLoading();
    });
  },

  getCourseIcon(name) {
    const icons = {
      'é’¢ç´': 'ğŸ¹',
      'å‰ä»–': 'ğŸ¸',
      'å£°ä¹': 'ğŸ¤',
      'å¤ç­': 'ğŸ»',
      'å°æç´': 'ğŸ»',
      'æ¶å­é¼“': 'ğŸ¥',
      'å°¤å…‹é‡Œé‡Œ': 'ğŸ¸',
      'è¨å…‹æ–¯': 'ğŸº'
    };
    return icons[name] || 'ğŸµ';
  },

  selectCourse(e) {
    const { id, name } = e.currentTarget.dataset;
    wx.navigateTo({
      url: `/pages/teacher/list?courseId=${id}&courseName=${name}`
    });
  }
});

// ========== /pages/course/list.wxml ==========
`<view class="container">
  <view class="course-grid">
    <view class="course-card" 
          wx:for="{{courseTypes}}" 
          wx:key="id"
          bindtap="selectCourse"
          data-id="{{item.id}}"
          data-name="{{item.name}}">
      <view class="course-icon">{{item.icon}}</view>
      <view class="course-name">{{item.name}}</view>
      <view class="course-desc">{{item.description || 'ä¸“ä¸šæ•™å­¦ï¼Œå¿«é€Ÿæå‡'}}</view>
      <view class="course-stats">
        <text class="stat">{{item.teacherCount}}ä½è€å¸ˆ</text>
        <text class="stat">{{item.studentCount}}ä½å­¦ç”Ÿ</text>
      </view>
    </view>
  </view>
</view>`

// ========== /pages/course/list.wxss ==========
`.course-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20rpx;
  padding: 20rpx;
}

.course-card {
  background: white;
  border-radius: 20rpx;
  padding: 30rpx;
  text-align: center;
  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
  transition: all 0.3s;
}

.course-card:active {
  transform: scale(0.98);
}

.course-icon {
  font-size: 80rpx;
  margin-bottom: 20rpx;
}

.course-name {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 10rpx;
}

.course-desc {
  font-size: 24rpx;
  color: #999;
  margin-bottom: 20rpx;
}

.course-stats {
  display: flex;
  justify-content: center;
  gap: 20rpx;
}

.stat {
  font-size: 22rpx;
  color: #666;
  padding: 4rpx 12rpx;
  background: #f5f5f5;
  border-radius: 10rpx;
}`

// ========== /pages/course/list.json ==========
// {
//   "navigationBarTitleText": "å…¨éƒ¨è¯¾ç¨‹"
// }